#!/bin/bash
CAN_STATE=`ifconfig can0 2>&1 | grep UP`
echo ${CAN_STATE}

if [[ ${CAN_STATE} == *"UP"* ]]; then
	echo can bus is up
else
	echo can0 not found, brining up ...
	ip link set can0 up type can bitrate 500000
fi


#while getopts ":p:" opt; do
#	case ${opt} in
#	p )
#		PIDFILE=$OPTARG
##		echo $$ > ${PIDFILE}
#	;;
#	\? )
#		echo "Invalid option: $OPTARG" 1>&2
#	;;
#	: )
#		echo "Invalid option: $OPTARG requires an argument" 1>&2
#	;;
#	esac
#done
#shift $((OPTIND -1))

#sudo socat -d -d INTERFACE:can0,pf=29,type=3,prototype=1 TCP-LISTEN:2000,fork,reuseaddr
#sudo socat INTERFACE:can0,pf=29,type=3,prototype=1 TCP-LISTEN:2000,fork,reuseaddr
socat INTERFACE:can0,pf=29,type=3,prototype=1 UDP-LISTEN:2000,fork,reuseaddr,sndbuf=32 
#SPID=$!
##echo ${SPID}
#if [ -n "$PIDFILE" ];
#then
#	echo ${SPID} > ${PIDFILE}
#fi
